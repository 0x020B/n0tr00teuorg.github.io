{"version":3,"file":"lib.cjs","sources":["../../src/lib.js"],"sourcesContent":["/**\r\n * A client library for the https://filebase.storage/ service. It provides a convenient\r\n * interface for working with the [Raw HTTP API](https://filebase.storage/#api-docs)\r\n * from a web browser or [Node.js](https://nodejs.org/) and comes bundled with\r\n * TS for out-of-the box type inference and better IntelliSense.\r\n *\r\n * @example\r\n * ```js\r\n * import { FilebaseClient, File, Blob } from \"filebase.storage\"\r\n * const client = new FilebaseClient({ token: API_TOKEN })\r\n *\r\n * const cid = await client.storeBlob(new Blob(['hello world']))\r\n * ```\r\n * @module\r\n */\r\n\r\nimport { pack } from 'ipfs-car/pack'\r\nimport { CID } from 'multiformats/cid'\r\nimport * as Token from './token.js'\r\nimport { File, Blob, FormData, Blockstore } from './platform.js'\r\nimport { toGatewayURL } from './gateway.js'\r\nimport { BlockstoreCarReader } from './bs-car-reader.js'\r\nimport pipe from 'it-pipe'\r\nimport { Upload } from \"@aws-sdk/lib-storage\";\r\nimport { S3Client, HeadObjectCommand, DeleteObjectCommand } from \"@aws-sdk/client-s3\";\r\nimport stream from 'node:stream'\r\n\r\nconst MAX_STORE_RETRIES = 5\r\nconst MAX_CONCURRENT_UPLOADS = 4\r\nconst DEFAULT_ENDPOINT = 'https://s3.filebase.com'\r\n\r\n/**\r\n * @typedef {import('./lib/interface.js').Service} Service\r\n * @typedef {import('./lib/interface.js').CIDString} CIDString\r\n * @typedef {import('./lib/interface.js').Deal} Deal\r\n * @typedef {import('./lib/interface.js').FileObject} FileObject\r\n * @typedef {import('./lib/interface.js').FilesSource} FilesSource\r\n * @typedef {import('./lib/interface.js').Pin} Pin\r\n * @typedef {import('./lib/interface.js').CarReader} CarReader\r\n * @typedef {import('./lib/interface.js').S3ClientConfig} S3ClientConfig\r\n * @typedef {import('ipfs-car/blockstore').Blockstore} BlockstoreI\r\n * @typedef {import('./lib/interface.js').RateLimiter} RateLimiter\r\n */\r\n\r\n/**\r\n * @template {import('./lib/interface.js').TokenInput} T\r\n * @typedef {import('./lib/interface.js').Token<T>} TokenType\r\n */\r\n\r\n/**\r\n * Parses Authentication Token\r\n *\r\n * @param {string | string[]} tokenToParse\r\n * @returns {import('./lib/interface.js').ParseTokenResult}\r\n */\r\nfunction parseToken(tokenToParse) {\r\n  if (Array.isArray(tokenToParse)) {\r\n    if (typeof tokenToParse[2] === \"undefined\") {\r\n      throw new Error(`No Bucket Found`);\r\n    }\r\n    return {\r\n      credentials: tokenToParse,\r\n      bucket: tokenToParse[2]\r\n    }\r\n  }\r\n\r\n  const token = atob(tokenToParse).split(':')\r\n  const bucket = token[2]\r\n\r\n  if (typeof token === \"undefined\" || !Array.isArray(token)) {\r\n    throw new Error(`Token Not Found`)\r\n  }\r\n\r\n  if (typeof token[0] !== \"string\") {\r\n    throw new Error(`Invalid Access Key`)\r\n  }\r\n\r\n  if (typeof token[1] !== \"string\") {\r\n    throw new Error(`Invalid Secret Key`)\r\n  }\r\n\r\n  if (typeof bucket === \"undefined\") {\r\n    throw new Error(`No Bucket Found`);\r\n  }\r\n\r\n  return {\r\n    credentials: token,\r\n    bucket: bucket\r\n  }\r\n}\r\n\r\n/**\r\n */\r\nclass FilebaseClient {\r\n  /**\r\n   * Constructs a client bound to the given `options.token` and\r\n   * `options.endpoint`.\r\n   *\r\n   * @example\r\n   * ```js\r\n   * import { FilebaseClient, File, Blob } from \"filebase.storage\"\r\n   * const client = new FilebaseClient({ token: API_TOKEN })\r\n   *\r\n   * const cid = await client.storeBlob(new Blob(['hello world']))\r\n   * ```\r\n   * Optionally you could pass an alternative API endpoint (e.g. for testing)\r\n   * @example\r\n   * ```js\r\n   * import { FilebaseClient } from \"filebase.storage\"\r\n   * const client = new FilebaseClient({\r\n   *   token: API_TOKEN\r\n   *   endpoint: new URL('http://localhost:8080/')\r\n   * })\r\n   * ```\r\n   *\r\n   * @param {{token: string, endpoint?: string, s3config?: S3ClientConfig, bucket?: string}} options\r\n   */\r\n  constructor({\r\n    endpoint = DEFAULT_ENDPOINT,\r\n    token,\r\n    s3config,\r\n    bucket\r\n  }) {\r\n    this.endpoint = endpoint\r\n\r\n    if (typeof token === \"undefined\" && s3config) {\r\n      this.s3config = s3config\r\n      if (typeof this.s3config.credentials === \"undefined\") {\r\n        throw new Error(`Must pass credentials`)\r\n      }\r\n    } else {\r\n      const parsedToken = parseToken(token)\r\n      this.token = parsedToken.credentials\r\n      this.bucket = bucket || parsedToken.bucket\r\n\r\n      this.s3config = {\r\n        credentials: {\r\n          accessKeyId: this.token[0] || \"\",\r\n          secretAccessKey: this.token[1] || \"\"\r\n        },\r\n        endpoint: endpoint,\r\n        maxAttempts: MAX_STORE_RETRIES,\r\n        region: \"us-east-1\",\r\n        forcePathStyle: true,\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stores a single file and returns its CID.\r\n   *\r\n   * @param {Service} service\r\n   * @param {Blob} blob\r\n   * @param {string | null} objectName\r\n   * @returns {Promise<CIDString>}\r\n   */\r\n  static async storeBlob(service, blob, objectName = null) {\r\n    const blockstore = new Blockstore()\r\n\r\n    try {\r\n      const { cid, car } = await FilebaseClient.encodeBlob(blob, { blockstore })\r\n      await FilebaseClient.storeCar(service, car, objectName || cid.toString())\r\n\r\n      return cid.toString();\r\n    } finally {\r\n      await blockstore.close()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stores a CAR file and returns its root CID.\r\n   *\r\n   * @param {Service} service\r\n   * @param {AsyncIterable<Uint8Array>} car\r\n   * @param {string} objectName\r\n   * @param {import('./lib/interface.js').CarStorerOptions} [options]\r\n   * @returns {Promise<CIDString>}\r\n   */\r\n  static async storeCar(\r\n    { endpoint, token, s3config, bucket },\r\n    car,\r\n    objectName ,\r\n    { onStoredChunk, onComplete, maxRetries} = {}\r\n  ) {\r\n    const selectedEndpoint = endpoint || DEFAULT_ENDPOINT;\r\n\r\n    if (typeof s3config === \"undefined\" && typeof token !== \"undefined\") {\r\n      const parsedToken = await parseToken(token)\r\n      this.token = parsedToken.credentials\r\n      this.bucket = bucket || parsedToken.bucket\r\n\r\n      s3config = {\r\n        credentials: {\r\n          accessKeyId: this.token[0] || \"\",\r\n          secretAccessKey: this.token[1] || \"\"\r\n        },\r\n        endpoint: selectedEndpoint,\r\n        maxAttempts: maxRetries || MAX_STORE_RETRIES,\r\n        region: \"us-east-1\",\r\n        forcePathStyle: true,\r\n      }\r\n    } else {\r\n      this.bucket = bucket\r\n    }\r\n\r\n    if (typeof s3config === \"undefined\") {\r\n      throw new Error(`s3config not defined`)\r\n    }\r\n\r\n    const s3client = new S3Client(s3config);\r\n\r\n    // Convert to an S3 upload of the full car\r\n    const readableStream = stream.Readable.from(car)\r\n    onComplete && readableStream.on('finish', onComplete)\r\n    const parallelUploads3 = new Upload({\r\n      client: s3client,\r\n      params: {\r\n        Bucket: this.bucket,\r\n        Key: objectName,\r\n        Body: readableStream,\r\n        Metadata: {\r\n          import: 'car'\r\n        },\r\n      },\r\n      queueSize: MAX_CONCURRENT_UPLOADS,\r\n      leavePartsOnError: false, // optional manually handle dropped parts\r\n    });\r\n\r\n    let storedBytes = 0.01\r\n    let progressBytes = storedBytes\r\n    parallelUploads3.on(\"httpUploadProgress\", (progress) => {\r\n      if (typeof progress.loaded !== \"number\") {\r\n        throw new Error(`Expected Number for Loaded Progress`);\r\n      }\r\n      progressBytes = progress.loaded - storedBytes;\r\n      storedBytes = progress.loaded;\r\n      onStoredChunk && onStoredChunk(progressBytes)\r\n    });\r\n\r\n    const uploadResult = await parallelUploads3.done();\r\n    console.dir(uploadResult);\r\n\r\n    const headCommand = new HeadObjectCommand({\r\n      Bucket: this.bucket,\r\n      Key: objectName,\r\n    })\r\n    const carHeader = await s3client.send(headCommand);\r\n\r\n    if (typeof carHeader.Metadata === \"undefined\" || typeof carHeader.Metadata['cid'] === \"undefined\") {\r\n      throw new Error(`No CID Returned from Remote`)\r\n    }\r\n\r\n    return carHeader.Metadata['cid'];\r\n  }\r\n\r\n  /**\r\n   * Stores a directory of files and returns a CID. Provided files **MUST**\r\n   * be within the same directory, otherwise error is raised e.g. `foo/bar.png`,\r\n   * `foo/bla/baz.json` is ok but `foo/bar.png`, `bla/baz.json` is not.\r\n   *\r\n   * @param {Service} service\r\n   * @param {FilesSource} filesSource\r\n   * @param {string | null} objectName\r\n   * @returns {Promise<CIDString>}\r\n   */\r\n  static async storeDirectory(service, filesSource, objectName = null) {\r\n    const blockstore = new Blockstore()\r\n    let cidString\r\n    try {\r\n      const { cid, car } = await FilebaseClient.encodeDirectory(filesSource, {\r\n        blockstore,\r\n      })\r\n      cidString = cid.toString()\r\n      await FilebaseClient.storeCar(service, car, objectName || cid.toString())\r\n    } finally {\r\n      await blockstore.close()\r\n    }\r\n\r\n    return cidString\r\n  }\r\n\r\n  /**\r\n   * Stores the given token and all resources it references (in the form of a\r\n   * File or a Blob) along with a metadata JSON as specificed in ERC-1155. The\r\n   * `token.image` must be either a `File` or a `Blob` instance, which will be\r\n   * stored and the corresponding content address URL will be saved in the\r\n   * metadata JSON file under `image` field.\r\n   *\r\n   * If `token.properties` contains properties with `File` or `Blob` values,\r\n   * those also get stored and their URLs will be saved in the metadata JSON\r\n   * file in their place.\r\n   *\r\n   * Note: URLs for `File` objects will retain file names e.g. in case of\r\n   * `new File([bytes], 'cat.png', { type: 'image/png' })` will be transformed\r\n   * into a URL that looks like `ipfs://bafy...hash/image/cat.png`. For `Blob`\r\n   * objects, the URL will not have a file name name or mime type, instead it\r\n   * will be transformed into a URL that looks like\r\n   * `ipfs://bafy...hash/image/blob`.\r\n   *\r\n   * @template {import('./lib/interface.js').TokenInput} T\r\n   * @param {Service} service\r\n   * @param {T} metadata\r\n   * @param {string | null} objectName\r\n   * @returns {Promise<TokenType<T>>}\r\n   */\r\n  static async store(service, metadata, objectName = null) {\r\n    const { token, car, cid } = await FilebaseClient.encodeNFT(metadata)\r\n    await FilebaseClient.storeCar(service, car, objectName || cid.toString())\r\n    return token\r\n  }\r\n\r\n  /**\r\n   * Returns current status of the stored NFT by its CID. Note the NFT must\r\n   * have previously been stored by this account.\r\n   *\r\n   * @param {Service} service\r\n   * @param {string} cid\r\n   * @param {string | null} objectName\r\n   * @returns {Promise<import('./lib/interface.js').StatusResult>}\r\n   */\r\n  static async status(\r\n    { endpoint, token, s3config, bucket },\r\n    cid,\r\n    objectName\r\n  ) {\r\n    const selectedEndpoint = endpoint || DEFAULT_ENDPOINT;\r\n\r\n    if (typeof s3config === \"undefined\" && typeof token !== \"undefined\") {\r\n      const parsedToken = parseToken(token)\r\n      this.token = parsedToken.credentials\r\n      this.bucket = bucket || parsedToken.bucket\r\n\r\n      s3config = {\r\n        credentials: {\r\n          accessKeyId: this.token[0] || \"\",\r\n          secretAccessKey: this.token[1] || \"\"\r\n        },\r\n        endpoint: selectedEndpoint,\r\n        maxAttempts: MAX_STORE_RETRIES,\r\n        region: \"us-east-1\",\r\n        forcePathStyle: true,\r\n      }\r\n    } else {\r\n      this.bucket = bucket\r\n    }\r\n\r\n    if (typeof s3config === \"undefined\") {\r\n      throw new Error(`s3config not defined`)\r\n    }\r\n\r\n    const s3client = new S3Client(s3config);\r\n\r\n    const headCommand = new HeadObjectCommand({\r\n      Bucket: this.bucket,\r\n      Key: objectName || cid,\r\n    })\r\n    const carHeader = await s3client.send(headCommand);\r\n\r\n    if (typeof carHeader.Metadata === \"undefined\" || typeof carHeader.Metadata['cid'] === \"undefined\") {\r\n      throw new Error(`No CID Returned from Remote`)\r\n    }\r\n\r\n    if (typeof carHeader['ContentLength'] !== \"number\") {\r\n      throw new Error(`Invalid Content Length`)\r\n    }\r\n\r\n    const displayDate = carHeader.LastModified;\r\n\r\n    if (typeof displayDate === \"undefined\") {\r\n      throw new Error('Invalid Date')\r\n    }\r\n\r\n    return {\r\n      cid: carHeader.Metadata['cid'],\r\n      size: carHeader['ContentLength'],\r\n      deals: [],\r\n      pin: {\r\n        cid: carHeader.Metadata['cid'],\r\n        name: carHeader.Metadata['cid'],\r\n        status: 'pinned',\r\n        created: displayDate,\r\n      },\r\n      created: displayDate,\r\n    }\r\n  }\r\n\r\n\r\n  /**\r\n   * Removes stored content by its CID from this account. Please note that\r\n   * even if content is removed from the service other nodes that have\r\n   * replicated it might still continue providing it.\r\n   *\r\n   * @param {Service} service\r\n   * @param {string} cid\r\n   * @param {string | null} objectName\r\n   * @returns {Promise<void>}\r\n   */\r\n  static async delete(\r\n    { endpoint, token, s3config, bucket },\r\n    cid,\r\n    objectName = null\r\n  ) {\r\n    const selectedEndpoint = endpoint || DEFAULT_ENDPOINT\r\n\r\n    if (typeof s3config === \"undefined\" && typeof token !== \"undefined\") {\r\n      const parsedToken = parseToken(token)\r\n      this.token = parsedToken.credentials\r\n      this.bucket = bucket || parsedToken.bucket\r\n\r\n      s3config = {\r\n        credentials: {\r\n          accessKeyId: this.token[0] || \"\",\r\n          secretAccessKey: this.token[1] || \"\"\r\n        },\r\n        endpoint: selectedEndpoint,\r\n        region: \"us-east-1\",\r\n        forcePathStyle: true,\r\n      }\r\n    } else {\r\n      this.bucket = bucket;\r\n    }\r\n\r\n    if (typeof s3config === \"undefined\") {\r\n      throw new Error(`s3config not defined`)\r\n    }\r\n\r\n    const s3client = new S3Client(s3config);\r\n\r\n    const deleteCommand = new DeleteObjectCommand({\r\n      Bucket: this.bucket,\r\n      Key: objectName || cid,\r\n    })\r\n\r\n    await s3client.send(deleteCommand);\r\n  }\r\n\r\n  /**\r\n   * Encodes the given token and all resources it references (in the form of a\r\n   * File or a Blob) along with a metadata JSON as specificed in ERC-1155 to a\r\n   * CAR file. The `token.image` must be either a `File` or a `Blob` instance,\r\n   * which will be stored and the corresponding content address URL will be\r\n   * saved in the metadata JSON file under `image` field.\r\n   *\r\n   * If `token.properties` contains properties with `File` or `Blob` values,\r\n   * those also get stored and their URLs will be saved in the metadata JSON\r\n   * file in their place.\r\n   *\r\n   * Note: URLs for `File` objects will retain file names e.g. in case of\r\n   * `new File([bytes], 'cat.png', { type: 'image/png' })` will be transformed\r\n   * into a URL that looks like `ipfs://bafy...hash/image/cat.png`. For `Blob`\r\n   * objects, the URL will not have a file name name or mime type, instead it\r\n   * will be transformed into a URL that looks like\r\n   * `ipfs://bafy...hash/image/blob`.\r\n   *\r\n   * @example\r\n   * ```js\r\n   * const { token, car } = await FilebaseClient.encodeNFT({\r\n   *   name: 'filebase.storage store test',\r\n   *   description: 'Test ERC-1155 compatible metadata.',\r\n   *   image: new File(['<DATA>'], 'pinpie.jpg', { type: 'image/jpg' }),\r\n   *   properties: {\r\n   *     custom: 'Custom data can appear here, files are auto uploaded.',\r\n   *     file: new File(['<DATA>'], 'README.md', { type: 'text/plain' }),\r\n   *   }\r\n   * })\r\n   *\r\n   * console.log('IPFS URL for the metadata:', token.url)\r\n   * console.log('metadata.json contents:\\n', token.data)\r\n   * console.log('metadata.json with IPFS gateway URLs:\\n', token.embed())\r\n   *\r\n   * // Now store the CAR file on filebase.storage\r\n   * await client.storeCar(car)\r\n   * ```\r\n   *\r\n   * @template {import('./lib/interface.js').TokenInput} T\r\n   * @param {T} input\r\n   * @returns {Promise<{ cid: CID, token: TokenType<T>, car: AsyncIterable<Uint8Array> }>}\r\n   */\r\n  static async encodeNFT(input) {\r\n    validateERC1155(input)\r\n    return Token.Token.encode(input)\r\n  }\r\n\r\n  /**\r\n   * Encodes a single file to a CAR file and also returns its root CID.\r\n   *\r\n   * @example\r\n   * ```js\r\n   * const content = new Blob(['hello world'])\r\n   * const { cid, car } = await FilebaseClient.encodeBlob(content)\r\n   *\r\n   * // Root CID of the file\r\n   * console.log(cid.toString())\r\n   *\r\n   * // Now store the CAR file on filebase.storage\r\n   * await client.storeCar(car)\r\n   * ```\r\n   *\r\n   * @param {Blob} blob\r\n   * @param {object} [options]\r\n   * @param {BlockstoreI} [options.blockstore]\r\n   * @returns {Promise<{ cid: CID, car: AsyncIterable<Uint8Array> }>}\r\n   */\r\n  static async encodeBlob(blob, { blockstore } = {}) {\r\n    if (blob.size === 0) {\r\n      throw new Error('Content size is 0, make sure to provide some content')\r\n    }\r\n    return packCar([toImportCandidate('blob', blob)], {\r\n      blockstore,\r\n      wrapWithDirectory: false,\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Encodes a directory of files to a CAR file and also returns the root CID.\r\n   * Provided files **MUST** be within the same directory, otherwise error is\r\n   * raised e.g. `foo/bar.png`, `foo/bla/baz.json` is ok but `foo/bar.png`,\r\n   * `bla/baz.json` is not.\r\n   *\r\n   * @example\r\n   * ```js\r\n   * const { cid, car } = await FilebaseClient.encodeDirectory([\r\n   *   new File(['hello world'], 'hello.txt'),\r\n   *   new File([JSON.stringify({'from': 'incognito'}, null, 2)], 'metadata.json')\r\n   * ])\r\n   *\r\n   * // Root CID of the directory\r\n   * console.log(cid.toString())\r\n   *\r\n   * // Now store the CAR file on filebase.storage\r\n   * await client.storeCar(car)\r\n   * ```\r\n   *\r\n   * @param {FilesSource} files\r\n   * @param {object} [options]\r\n   * @param {BlockstoreI} [options.blockstore]\r\n   * @returns {Promise<{ cid: CID, car: AsyncIterable<Uint8Array> }>}\r\n   */\r\n  static async encodeDirectory(files, { blockstore } = {}) {\r\n    let size = 0\r\n    const input = pipe(files, async function* (files) {\r\n      for await (const file of files) {\r\n        yield toImportCandidate(file.name, file)\r\n        size += file.size\r\n      }\r\n    })\r\n    const packed = await packCar(input, {\r\n      blockstore,\r\n      wrapWithDirectory: true,\r\n    })\r\n    if (size === 0) {\r\n      throw new Error(\r\n        'Total size of files should exceed 0, make sure to provide some content'\r\n      )\r\n    }\r\n    return packed\r\n  }\r\n\r\n  /**\r\n   * Stores a single file and returns the corresponding Content Identifier (CID).\r\n   * Takes a [Blob](https://developer.mozilla.org/en-US/docs/Web/API/Blob/Blob)\r\n   * or a [File](https://developer.mozilla.org/en-US/docs/Web/API/File). Note\r\n   * that no file name or file metadata is retained.\r\n   *\r\n   * @example\r\n   * ```js\r\n   * const content = new Blob(['hello world'])\r\n   * const cid = await client.storeBlob(content)\r\n   * cid //> 'zdj7Wn9FQAURCP6MbwcWuzi7u65kAsXCdjNTkhbJcoaXBusq9'\r\n   * ```\r\n   *\r\n   * @param {Blob} blob\r\n   * @param {string | null} objectName\r\n   */\r\n  storeBlob(blob, objectName = null) {\r\n    return FilebaseClient.storeBlob(this, blob, objectName)\r\n  }\r\n\r\n  /**\r\n   * Stores files encoded as a single [Content Addressed Archive\r\n   * (CAR)](https://github.com/ipld/specs/blob/master/block-layer/content-addressable-archives.md).\r\n   *\r\n   * Takes a [Blob](https://developer.mozilla.org/en-US/docs/Web/API/Blob/Blob)\r\n   * or a [File](https://developer.mozilla.org/en-US/docs/Web/API/File).\r\n   *\r\n   * Returns the corresponding Content Identifier (CID).\r\n   *\r\n   * See the [`ipfs-car` docs](https://www.npmjs.com/package/ipfs-car) for more\r\n   * details on packing a CAR file.\r\n   *\r\n   * @example\r\n   * ```js\r\n   * import { pack } from 'ipfs-car/pack'\r\n   * import { CarReader } from '@ipld/car'\r\n   * const { out, root } = await pack({\r\n   *  input: fs.createReadStream('pinpie.pdf')\r\n   * })\r\n   * const expectedCid = root.toString()\r\n   * const carReader = await CarReader.fromIterable(out)\r\n   * const cid = await storage.storeCar(carReader)\r\n   * console.assert(cid === expectedCid)\r\n   * ```\r\n   *\r\n   * @example\r\n   * ```\r\n   * import { packToBlob } from 'ipfs-car/pack/blob'\r\n   * const data = 'Hello world'\r\n   * const { root, car } = await packToBlob({ input: [new TextEncoder().encode(data)] })\r\n   * const expectedCid = root.toString()\r\n   * const cid = await client.storeCar(car)\r\n   * console.assert(cid === expectedCid)\r\n   * ```\r\n   * @param {AsyncIterable<Uint8Array>} car\r\n   * @param {string} objectName\r\n   * @param {import('./lib/interface.js').CarStorerOptions} [options]\r\n   */\r\n  storeCar(car, objectName, options) {\r\n    return FilebaseClient.storeCar(this, car, objectName, options)\r\n  }\r\n\r\n  /**\r\n   * Stores a directory of files and returns a CID for the directory.\r\n   *\r\n   * @example\r\n   * ```js\r\n   * const cid = await client.storeDirectory([\r\n   *   new File(['hello world'], 'hello.txt'),\r\n   *   new File([JSON.stringify({'from': 'incognito'}, null, 2)], 'metadata.json')\r\n   * ])\r\n   * cid //>\r\n   * ```\r\n   *\r\n   * Argument can be a [FileList](https://developer.mozilla.org/en-US/docs/Web/API/FileList)\r\n   * instance as well, in which case directory structure will be retained.\r\n   *\r\n   * @param {FilesSource} files\r\n   * @param {string | null} objectName\r\n   */\r\n  storeDirectory(files, objectName = null) {\r\n    return FilebaseClient.storeDirectory(this, files, objectName)\r\n  }\r\n\r\n  /**\r\n   * Returns current status of the stored NFT by its CID. Note the NFT must\r\n   * have previously been stored by this account.\r\n   *\r\n   * @example\r\n   * ```js\r\n   * const status = await client.status('zdj7Wn9FQAURCP6MbwcWuzi7u65kAsXCdjNTkhbJcoaXBusq9')\r\n   * ```\r\n   *\r\n   * @param {string} cid\r\n   * @param {string | null} objectName\r\n   */\r\n  status(cid, objectName = null) {\r\n    return FilebaseClient.status(this, cid, objectName)\r\n  }\r\n\r\n  /**\r\n   * Removes stored content by its CID from the service.\r\n   *\r\n   * > Please note that even if content is removed from the service other nodes\r\n   * that have replicated it might still continue providing it.\r\n   *\r\n   * @example\r\n   * ```js\r\n   * await client.delete('zdj7Wn9FQAURCP6MbwcWuzi7u65kAsXCdjNTkhbJcoaXBusq9')\r\n   * ```\r\n   *\r\n   * @param {string} cid\r\n   * @param {string | null} objectName\r\n   */\r\n  delete(cid, objectName = null) {\r\n    return FilebaseClient.delete(this, cid, objectName)\r\n  }\r\n\r\n  /**\r\n   * Stores the given token and all resources it references (in the form of a\r\n   * File or a Blob) along with a metadata JSON as specificed in\r\n   * [ERC-1155](https://eips.ethereum.org/EIPS/eip-1155#metadata). The\r\n   * `token.image` must be either a `File` or a `Blob` instance, which will be\r\n   * stored and the corresponding content address URL will be saved in the\r\n   * metadata JSON file under `image` field.\r\n   *\r\n   * If `token.properties` contains properties with `File` or `Blob` values,\r\n   * those also get stored and their URLs will be saved in the metadata JSON\r\n   * file in their place.\r\n   *\r\n   * Note: URLs for `File` objects will retain file names e.g. in case of\r\n   * `new File([bytes], 'cat.png', { type: 'image/png' })` will be transformed\r\n   * into a URL that looks like `ipfs://bafy...hash/image/cat.png`. For `Blob`\r\n   * objects, the URL will not have a file name name or mime type, instead it\r\n   * will be transformed into a URL that looks like\r\n   * `ipfs://bafy...hash/image/blob`.\r\n   *\r\n   * @example\r\n   * ```js\r\n   * const metadata = await client.store({\r\n   *   name: 'filebase.storage store test',\r\n   *   description: 'Test ERC-1155 compatible metadata.',\r\n   *   image: new File(['<DATA>'], 'pinpie.jpg', { type: 'image/jpg' }),\r\n   *   properties: {\r\n   *     custom: 'Custom data can appear here, files are auto uploaded.',\r\n   *     file: new File(['<DATA>'], 'README.md', { type: 'text/plain' }),\r\n   *   }\r\n   * })\r\n   *\r\n   * console.log('IPFS URL for the metadata:', metadata.url)\r\n   * console.log('metadata.json contents:\\n', metadata.data)\r\n   * console.log('metadata.json with IPFS gateway URLs:\\n', metadata.embed())\r\n   * ```\r\n   *\r\n   * @template {import('./lib/interface.js').TokenInput} T\r\n   * @param {T} token\r\n   * @param {string | null} objectName\r\n   */\r\n  store(token, objectName = null) {\r\n    return FilebaseClient.store(this, token, objectName)\r\n  }\r\n}\r\n\r\n/**\r\n * Cast an iterable to an asyncIterable\r\n * @template T\r\n * @param {Iterable<T>} iterable\r\n * @returns {AsyncIterable<T>}\r\n */\r\nexport function toAsyncIterable(iterable) {\r\n  return (async function* () {\r\n    for (const item of iterable) {\r\n      yield item\r\n    }\r\n  })()\r\n}\r\n\r\n/**\r\n * @template {import('./lib/interface.js').TokenInput} T\r\n * @param {T} metadata\r\n */\r\nconst validateERC1155 = ({ name, description, image, decimals }) => {\r\n  // Just validate that expected fields are present\r\n  if (typeof name !== 'string') {\r\n    throw new TypeError(\r\n      'string property `name` identifying the asset is required'\r\n    )\r\n  }\r\n  if (typeof description !== 'string') {\r\n    throw new TypeError(\r\n      'string property `description` describing asset is required'\r\n    )\r\n  }\r\n  if (!(image instanceof Blob)) {\r\n    throw new TypeError('property `image` must be a Blob or File object')\r\n  } else if (!image.type.startsWith('image/')) {\r\n    console.warn(`According to ERC721 Metadata JSON Schema 'image' must have 'image/*' mime type.\r\n\r\nFor better interoperability we would highly recommend storing content with different mime type under 'properties' namespace e.g. \\`properties: { video: file }\\` and using 'image' field for storing a preview image for it instead.\r\n\r\nFor more context please see ERC-721 specification https://eips.ethereum.org/EIPS/eip-721`)\r\n  }\r\n\r\n  if (typeof decimals !== 'undefined' && typeof decimals !== 'number') {\r\n    throw new TypeError('property `decimals` must be an integer value')\r\n  }\r\n}\r\n\r\n/**\r\n * @param {import('ipfs-car/pack').ImportCandidateStream|Array<{ path: string, content: import('./platform.js').ReadableStream }>} input\r\n * @param {object} [options]\r\n * @param {BlockstoreI} [options.blockstore]\r\n * @param {boolean} [options.wrapWithDirectory]\r\n */\r\nconst packCar = async (input, { blockstore, wrapWithDirectory } = {}) => {\r\n  /* c8 ignore next 1 */\r\n  blockstore = blockstore || new Blockstore()\r\n  const { root: cid, out } = await pack({ input, blockstore, wrapWithDirectory, rawLeaves: false, cidVersion: 0 })\r\n  const car = new BlockstoreCarReader(1, [cid], blockstore)\r\n  return { cid, carReader: car, car: out }\r\n}\r\n\r\n/**\r\n * Convert the passed blob to an \"import candidate\" - an object suitable for\r\n * passing to the ipfs-unixfs-importer. Note: content is an accessor so that\r\n * the stream is created only when needed.\r\n *\r\n * @param {string} path\r\n * @param {Pick<Blob, 'stream'>|{ stream: () => AsyncIterable<Uint8Array> }} blob\r\n * @returns {import('ipfs-core-types/src/utils.js').ImportCandidate}\r\n */\r\nfunction toImportCandidate(path, blob) {\r\n  /** @type {AsyncIterable<Uint8Array>} */\r\n  let stream\r\n  return {\r\n    path,\r\n    get content() {\r\n      stream = stream || blob.stream()\r\n      return stream\r\n    },\r\n  }\r\n}\r\n\r\nexport { FilebaseClient, File, Blob, FormData, toGatewayURL, Token }\r\n"],"names":["Blockstore","S3Client","stream","Upload","HeadObjectCommand","DeleteObjectCommand","Token.Token","pipe","Blob","pack","BlockstoreCarReader"],"mappings":"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;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,SAAS,CAAC,IAAI,EAAE,UAAU,GAAG,IAAI,EAAE;AACrC,IAAI,OAAO,cAAc,CAAC,SAAS,CAAC,IAAI,EAAE,IAAI,EAAE,UAAU,CAAC;AAC3D,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,QAAQ,CAAC,GAAG,EAAE,UAAU,EAAE,OAAO,EAAE;AACrC,IAAI,OAAO,cAAc,CAAC,QAAQ,CAAC,IAAI,EAAE,GAAG,EAAE,UAAU,EAAE,OAAO,CAAC;AAClE,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,cAAc,CAAC,KAAK,EAAE,UAAU,GAAG,IAAI,EAAE;AAC3C,IAAI,OAAO,cAAc,CAAC,cAAc,CAAC,IAAI,EAAE,KAAK,EAAE,UAAU,CAAC;AACjE,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,MAAM,CAAC,GAAG,EAAE,UAAU,GAAG,IAAI,EAAE;AACjC,IAAI,OAAO,cAAc,CAAC,MAAM,CAAC,IAAI,EAAE,GAAG,EAAE,UAAU,CAAC;AACvD,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,MAAM,CAAC,GAAG,EAAE,UAAU,GAAG,IAAI,EAAE;AACjC,IAAI,OAAO,cAAc,CAAC,MAAM,CAAC,IAAI,EAAE,GAAG,EAAE,UAAU,CAAC;AACvD,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,KAAK,CAAC,KAAK,EAAE,UAAU,GAAG,IAAI,EAAE;AAClC,IAAI,OAAO,cAAc,CAAC,KAAK,CAAC,IAAI,EAAE,KAAK,EAAE,UAAU,CAAC;AACxD,GAAG;AACH,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAAS,eAAe,CAAC,QAAQ,EAAE;AAC1C,EAAE,OAAO,CAAC,mBAAmB;AAC7B,IAAI,KAAK,MAAM,IAAI,IAAI,QAAQ,EAAE;AACjC,MAAM,MAAM,KAAI;AAChB,KAAK;AACL,GAAG,GAAG;AACN,CAAC;AACD;AACA;AACA;AACA;AACA;AACA,MAAM,eAAe,GAAG,CAAC,EAAE,IAAI,EAAE,WAAW,EAAE,KAAK,EAAE,QAAQ,EAAE,KAAK;AACpE;AACA,EAAE,IAAI,OAAO,IAAI,KAAK,QAAQ,EAAE;AAChC,IAAI,MAAM,IAAI,SAAS;AACvB,MAAM,0DAA0D;AAChE,KAAK;AACL,GAAG;AACH,EAAE,IAAI,OAAO,WAAW,KAAK,QAAQ,EAAE;AACvC,IAAI,MAAM,IAAI,SAAS;AACvB,MAAM,4DAA4D;AAClE,KAAK;AACL,GAAG;AACH,EAAE,IAAI,EAAE,KAAK,YAAYC,SAAI,CAAC,EAAE;AAChC,IAAI,MAAM,IAAI,SAAS,CAAC,gDAAgD,CAAC;AACzE,GAAG,MAAM,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,EAAE;AAC/C,IAAI,OAAO,CAAC,IAAI,CAAC,CAAC;AAClB;AACA;AACA;AACA,wFAAwF,CAAC,EAAC;AAC1F,GAAG;AACH;AACA,EAAE,IAAI,OAAO,QAAQ,KAAK,WAAW,IAAI,OAAO,QAAQ,KAAK,QAAQ,EAAE;AACvE,IAAI,MAAM,IAAI,SAAS,CAAC,8CAA8C,CAAC;AACvE,GAAG;AACH,EAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM,OAAO,GAAG,OAAO,KAAK,EAAE,EAAE,UAAU,EAAE,iBAAiB,EAAE,GAAG,EAAE,KAAK;AACzE;AACA,EAAE,UAAU,GAAG,UAAU,IAAI,IAAIR,eAAU,GAAE;AAC7C,EAAE,MAAM,EAAE,IAAI,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,MAAMS,SAAI,CAAC,EAAE,KAAK,EAAE,UAAU,EAAE,iBAAiB,EAAE,SAAS,EAAE,KAAK,EAAE,UAAU,EAAE,CAAC,EAAE,EAAC;AAClH,EAAE,MAAM,GAAG,GAAG,IAAIC,+BAAmB,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,UAAU,EAAC;AAC3D,EAAE,OAAO,EAAE,GAAG,EAAE,SAAS,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE;AAC1C,EAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS,iBAAiB,CAAC,IAAI,EAAE,IAAI,EAAE;AACvC;AACA,EAAE,IAAI,OAAM;AACZ,EAAE,OAAO;AACT,IAAI,IAAI;AACR,IAAI,IAAI,OAAO,GAAG;AAClB,MAAM,MAAM,GAAG,MAAM,IAAI,IAAI,CAAC,MAAM,GAAE;AACtC,MAAM,OAAO,MAAM;AACnB,KAAK;AACL,GAAG;AACH;;;;;;;;;;;;;;;;;;;;;;;;;"}